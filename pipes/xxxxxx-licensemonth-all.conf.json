{
  "_id": "xxxxxx-licensemonth-all",
  "type": "pipe",
  "source": {
    "type": "dataset",
    "dataset": "xxxxxx-licenses-collect"
  },
  "transform": {
    "type": "dtl",
    "rules": {
      "default": [
        ["add", "_month_count",
          ["range", 0,
            ["plus", 1,
              ["datetime-diff", "month",
                ["now"],
                ["datetime-parse", "%Y-%m-%dT%H:%M:%S.%fZ", "_S.activation_datetime"]
              ]
            ]
          ]
        ],
        ["create-child",
          ["apply", "license_month", "_T._month_count"]
        ]
      ],
      "license_month": [
        ["add", "license_id", "_R._S.license_id"],
        ["add", "date_start",
          ["datetime-format", "%Y-%m",
            ["datetime-plus", "month", "_S.",
              ["datetime-parse", "%Y-%m-%dT%H:%M:%S.%fZ", "_R._S.activation_datetime"]
            ]
          ]
        ],
        ["comment", "adding a random variable value to trigger reprosessing of this months entities"],
        ["if",
          ["eq",
            ["datetime-diff", "month",
              ["now"],
              ["datetime-parse", "%Y-%m", "_T.date_start"]
            ], 1],
          ["add", "temp_reprocess_var",
            ["uuid"]
          ]
        ],
        ["add", "_id",
          ["concat", "_R._S._id", "-", "_T.date_start"]
        ]
      ]
    }
  },
  "namespaced_identifiers": false
}
